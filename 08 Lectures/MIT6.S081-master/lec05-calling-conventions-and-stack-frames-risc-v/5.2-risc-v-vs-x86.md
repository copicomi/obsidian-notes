# 5.2 RISC-V vs x86

你们将会注意到，我们在这节课中反复会提到了 RISC-V 汇编。这一点很重要，因为汇编语言有很多种（注，因为不同的处理器指令集不一样，而汇编语言中都是一条条指令，所以不同处理器对应的汇编语言必然不一样）。如果你使用 RISC-V，你不太能将 Linux 运行在上面。相应的，大多数现代计算机都运行在 x86 和 x86-64 处理器上。x86 拥有一套不同的指令集，看起来与 RISC-V 非常相似。通常你们的个人电脑上运行的处理器是 x86，Intel 和 AMD 的 CPU 都实现了 x86。

![](<../assets/image (841).png>)

RISC-V 和 x86 并没有它们第一眼看起来那么相似。RISC-V 中的 RISC 是精简指令集（Reduced Instruction Set Computer）的意思，而 x86 通常被称为 CISC，复杂指令集（Complex Instruction Set Computer）。这两者之间有一些关键的区别：

- 首先是指令的数量。实际上，创造 RISC-V 的一个非常大的初衷就是因为 Intel 手册中指令数量太多了。x86-64 指令介绍由 3 个文档组成，并且新的指令以每个月 3 条的速度在增加。因为 x86-64 是在 1970 年代发布的，所以我认为现在有多于 15000 条指令。RISC-V 指令介绍由两个文档组成。在这节课中，不需要你们记住每一个 RISC-V 指令，但是如果你感兴趣或者你发现你不能理解某个具体的指令的话，在课程网站的参考页面有 RISC-V 指令的两个文档链接。这两个文档包含了 RISC-V 的指令集的所有信息，分别是 240 页和 135 页，相比 x86 的指令集文档要小得多的多。这是有关 RISC-V 比较好的一个方面。所以在 RISC-V 中，我们有更少的指令数量。
- 除此之外，RISC-V 指令也更加简单。在 x86-64 中，很多指令都做了不止一件事情。这些指令中的每一条都执行了一系列复杂的操作并返回结果。但是 RISC-V 不会这样做，RISC-V 的指令趋向于完成更简单的工作，相应的也消耗更少的 CPU 执行时间。这其实是设计人员的在底层设计时的取舍。并没有一些非常确定的原因说 RISC 比 CISC 更好。它们各自有各自的使用场景。
- 相比 x86 来说，RISC 另一件有意思的事情是它是开源的。这是市场上唯一的一款开源指令集，这意味着任何人都可以为 RISC-V 开发主板。RISC-V 是来自于 UC-Berkly 的一个研究项目，之后被大量的公司选中并做了支持，网上有这些公司的名单，许多大公司对于支持一个开源指令集都感兴趣。

我记得最近，作为主要的 RISC-V 处理器生产商，SiFive 宣称会发布一款基于 RISC-V 的主板，用来在个人计算机上运行 Linux 系统。如果你好奇或者想要使用 RISC-V，在你学完了 6.S081 之后，大概率你可以在你的个人电脑上通过 RISC-V 处理器运行 Linux。

在你们的日常生活中，你们可能已经在完全不知情的情况下使用了精简指令集。比如说 ARM 也是一个精简指令集，高通的 Snapdragon 处理器就是基于 ARM。如果你使用一个 Android 手机，那么大概率你的手机运行在精简指令集上。如果你使用 IOS，苹果公司也实现某种版本的 ARM 处理器，这些处理器运行在 iPad，iPhone 和大多数苹果移动设备上，甚至对于 Mac，苹果公司也在尝试向 ARM 做迁移（注，刚刚发布的 Macbook）。所以精简指令集出现在各种各样的地方。如果你想在现实世界中找到 RISC-V 处理器，你可以在一些嵌入式设备中找到。所以 RISC-V 也是有应用的，当然它可能没有 x86 那么流行。

![](<../assets/image (858).png>)

在最近几年，由于 Intel 的指令集是在是太大了，精简指令集的使用越来越多。Intel 的指令集之所以这么大，是因为 Intel 对于向后兼容非常看重。所以一个现代的 Intel 处理器还可以运行 30/40 年前的指令。Intel 并没有下线任何指令。而 RISC-V 提出的更晚，所以不存在历史包袱的问题。

> 学生提问：为什么 x86 会有 15000 条指令？
>
> TA：如我刚刚说的，我们需要许多指令来实现向后兼容，向后兼容是否重要因人而异。另一方面，我认为这里许多指令都是 cmd 指令，用来完成一些特殊的操作。我从来没有见过一个 Intel 的汇编代码使用了所有的 15000 个指令。大多数这些指令都是为了向后兼容和 cmd 的需求创建。

如果查看 RISC-V 的文档，可以发现 RISC-V 的特殊之处在于：它区分了 Base Integer Instruction Set 和 Standard Extension Instruction Set。Base Integer Instruction Set 包含了所有的常用指令，比如 add，mult。除此之外，处理器还可以选择性的支持 Standard Extension Instruction Set。例如，一个处理器可以选择支持 Standard Extension for Single-Precision Float-Point。这种模式使得 RISC-V 更容易支持向后兼容。 每一个 RISC-V 处理器可以声明支持了哪些扩展指令集，然后编译器可以根据支持的指令集来编译代码。

> 学生提问：看起来使用 x86 而不是 RISC-V 的唯一优势就是能得到性能的提升，但是这里的性能是以复杂度和潜在的安全为代价的，我的问题是为什么我们还在使用 x86，而不是使用 RISC-V 处理器？
>
> TA：我并没有一个很好的答案来回答。现在整个世界都运行在 x86 上，如果你突然将处理器转变成 RISC-V，那么你就会失去很多重要的软件支持。同时，Intel 在它的处理器里面做了一些有意思的事情，例如安全相关的 enclave，这是 Intel 最近加到处理器中来提升安全性的功能。此外，Intel 还实现了一些非常具体的指令，这些指令可以非常高效的进行一些特定的运算。所以 Intel 有非常多的指令，通常来说对于一个场景都会有一个完美的指令，它的执行效率要高于 RISC-V 中的同等指令。但是这个问题更实际的答案是，RISC-V 相对来说更新一些，目前还没有人基于 RISC-V 来制造个人计算机，SiFive 也就是最近才成为第一批将 RISC-V 应用到个人计算机的公司。所以，从实际的角度来说，因为不能在 RISC-V 上运行所有为 Intel 设计的软件，是我对这个问题的最好的答案。
