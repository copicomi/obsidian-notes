# 1.7 Shell

我说了很多 XV6 的长的很像 Unix 的 Shell，相对图形化用户接口来说，这里的 Shell 通常也是人们说的命令行接口。如果你还没有用过 Shell，Shell 是一种对于 Unix 系统管理来说非常有用的接口，它提供了很多工具来管理文件，编写程序，编写脚本。你之前看过我演示一些 Shell 的功能，通常来说，当你输入内容时，你是在告诉 Shell 运行相应的程序。所以当我输入 ls 时，实际的意义是我要求 Shell 运行名为 ls 的程序，文件系统中会有一个文件名为 ls，这个文件中包含了一些计算机指令，所以实际上，当我输入 ls 时，我是在要求 Shell 运行位于文件 ls 内的这些计算机指令。

我现在运行 ls，它实际的工作就是输出当前目录的文件列表。

![](<../assets/image (334).png>)

你可以看到第 4 行，就是一个叫做 ls 的文件。这就是包含了计算机指令的文件。

除了运行程序以外，Shell 还会做一些其他的事情，比如，它允许你能重定向 IO。比如，我输入 ls > out

![](<../assets/image (186).png>)

这里的实际意义是，我要求 Shell 运行 ls 命令，但是将输出重定向到一个叫做 out 的文件中。这里执行完成之后我们看不到任何的输出，因为输出都送到了 out 文件。现在我们知道 out 文件包含了一些数据，我们可以通过 cat 指令读取一个文件，并显示文件的内容。

![](<../assets/image (311).png>)

之后我们可以看到 ls 指令相同的输出。

你也可以运行一个名为 grep 的指令，并将 x 作为参数传给 grep。

![](<../assets/image (343).png>)

grep x 会搜索输入中包含 x 的行，我可以告诉 shell 将输入重定向到文件 out，这样我们就可以查看 out 中的 x。

![](<../assets/image (263).png>)

因为 out 文件包含了 ls 的输出，所以我们可以看出有 3 个文件的文件名包含了 x。

我们将会花很多时间在 Shell 上，Shell 是最传统，最基础的 Unix 接口。因为当 Unix 最开始被开发出来时，只有简单的终端接口，例如 Shell。Unix 最早的用途是给多个用户分时复用机器，用户通过 Shell 与机器交互。

> 学生提问：有一个系统调用和编译器的问题。编译器如何处理系统调用？生成的汇编语言是不是会调用一些由操作系统定义的代码段？
>
> Robert 教授：有一个特殊的 RISC-V 指令，程序可以调用这个指令，并将控制权交给内核。所以，实际上当你运行 C 语言并执行例如 open 或者 write 的系统调用时，从技术上来说，open 是一个 C 函数，但是这个函数内的指令实际上是机器指令，也就是说我们调用的 open 函数并不是一个 C 语言函数，它是由汇编语言实现，组成这个系统调用的汇编语言实际上在 RISC-V 中被称为 ecall。这个特殊的指令将控制权转给内核。之后内核检查进程的内存和寄存器，并确定相应的参数。
