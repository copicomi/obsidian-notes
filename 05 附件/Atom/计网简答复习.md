
##### *1、什么是协议，五层协议栈分别是什么，写出其作用和相关协议*

协议是因特网各个层次之间运行的统一标准。
五层协议栈：
1. 应用层
	- 用于提供进程到进程的通信服务
	- 协议：HTTP、FTP、SMTP、P2P
2. 运输层
	- 用于提供端口到端口的通信服务，保证数据可靠传输
	- 协议：TCP、UDP
3. 网络层
	- 用于提供网络节点（路由器、主机）之间的通信服务，实现IP到IP地址间的路由
	- 协议：OSPF、RIP、BGP、DHCP
4. 链路层
	- 用于提供网络设备（网卡，链路层交换机）之间的通信服务，MAC到MAC地址
	- 协议：ARP
5. 物理层
	- 用于提供链路两端的通信服务
---
##### *2、内网用NAT和DHCP访问外网的过程以及（NAT穿越问题）*

首先，本地主机通过DHCP协议，获取 IP 地址：
1. 向子网广播 DHCP 发现报文
2. DHCP 服务器直接或者通过 DHCP 中继代理 收到 该报文后，向源主机发送 DHCP 提供报文，其中包含 分配 IP、租用期、子网掩码、网关地址和本服务器地址
3. 源主机收到后，从收到的 DHCP 提供报文中，选择一个（可能有多个）发送 DHCP 请求报文
4. DHCP 服务器收到后，回复一个 DHCP ACK 报文，源主机收到 ACK 报文后，确认 IP 地址可用，DHCP服务过程结束

然后，本地主机通过 [[NAT]] 路由器，与外网通信：
1. 发送数据报到位于网关的 NAT 路由器
2. NAT 路由器将 该 IP 映射到 本地的一个端口号，修改数据报的发送方信息，使用公用 IP 与因特网通信
3. 当 NAT 路由器收到来自外网的数据报时，查找本地映射表，将接收方信息重新映射为本地网络内的一个 IP，再进行转发

---

##### *3、为什么实际带宽会小于链路带宽？TCP拥塞控制的机制和过程*

两类原因：
- 时延：
	- 传输、传播、排队、处理时延
	- 这些延迟是固定存在的
-  网络拥塞：
	- 当路由器的缓存已满时，会丢弃后来的数据包，产生丢包
	- TCP 为避免丢包，会进行拥塞控制，抑制数据传输
拥塞控制：
TCP维护一个拥塞窗口 cwnd，与慢启动阈值 s
该算法分为三个状态：
1. 慢启动（探测可用带宽）：
	- 起初窗口大小为 1，每收到一个正确 ACK 就将窗口增大 1，因此每个 RTT 窗口大小会翻倍，成指数增长
	- 当检测到拥塞时（超时），就设置 `S = cwnd/2`，`cwnd = 1`
	- 如果窗口大小达到慢启动阈值 S，就进入拥塞避免阶段
2. 拥塞避免（线性增长）：
	- 每个 RTT 将窗口增加 1
	- 当检测到拥塞时（超时），就设置 `S = cwnd/2`，`cwnd = 1`，回到慢启动状态
3. 快速恢复（抵消丢包带来的冗余ACK）：
	- 每当检测到 3 个冗余 ACK，就进入快速恢复阶段，设置`S = cwnd/2`，`cwnd = S+3`
	- 每收到一个冗余 ACK 就将 cwnd 增加 1
	- 检测到超时就重新设置cwnd和S，返回慢启动状态，到达阈值就进入拥塞避免阶段
---
##### *4、LAN多路访问协议中的协议以及每个协议的特点*

三类：
1.  信道划分协议：
	- TDMA：按时隙划分信道
	- FDMA：按频率划分信道
	- CDMA：按唯一编码划分信道
	- 带宽有上限
2. 随机接入协议：
	- ALOHA：分为纯 ALOHA和时隙  ALOHA，检测到碰撞时按照概率p决定是否重发，利用率较低
	- CSMA：发送前和发送时持续监听信道，防止冲突，其中CSMA/CD采用二进制指数后退算法
3. 轮流协议：
	- 轮询：执行一个主节点，轮流通知每个节点可以进行传输，轮询时延大
	- 令牌传递：将特殊的令牌（token）在网络中传递，只有持有token的节点才能进行传输，延迟高
---
##### *5、一个网段向另一个网段发送数据的过程（不知道对方mac地址，ARP原理）*

如果二者在同一子网内，就直接发送 ARP 询问获取MAC地址，下面假设二者不在同一子网

首先将数据发送到网关路由器：
1. 假设已经通过 DHCP 协议获取网络信息，本地主机广播 ARP 询问报文，将目的 IP 设为网关 IP，询问网关路由器的 MAC 地址
2. 网关路由器收到 ARP 询问后，发送 ARP 回复报文，包含网关的 MAC 地址
3. 本地主机收到 ARP 回复后，将数据报发送给网关路由器（目的 IP 不变，但目的 MAC 为网关地址）

再通过网关进行 AS 间的转发：
1. 网关路由器收到该数据报后，得知实际的目的 IP，通过 AS 间路由协议，查找路由表，将该数据转发给下一跳路由器
2. 如果不知道目的 MAC，仿照之前的操作，通过 ARP 协议获取 MAC 地址
3. 数据报通过层层网关的路由转发，最终到达目的 IP 

---
##### *6、描述一下死锁（给你一个rdt状态机让你描述）*

假设该 rdt 使用 0/1 序号包，使用 NAK 指示重传
当接收方期望收到 0 包，而发送方仍打算发送 1 包时会产生死锁，过程描述如下：
1. 发送方发送 1 包，接收方指示传输错误，回复 NAK
2. 发送方超时或收到 NAK 答复，继续重传 1 包，造成死循环，产生死锁

---
##### 7、*带冲突检测的载波监听多路的工作，及CSMA/CD二进制指数回退算法*

CSMA/CD 的工作过程：
1. 适配器从上层接收数据报，封装到链路层帧中
2. 发送数据帧前，监听信道中是否有其他信号正在传输，如果没有就开始传输，否则一直等待到信道空闲
3. 开始传输后，仍然持续监听信道中是否有其他信号在传输，如果有，发送一个阻塞信号，停止传输，等待随机时间后，回到步骤 2
4. 如果一直没检测到信道冲突，就认为数据帧已经成功传输
二进制回退算法：
- 当检测到第 n 次冲突时，从$[0, 2^{n}-1]$ 中随机选择一个整数 k，等待 $k * 512$ 比特时间后再运行
- 当冲突次数 n 大于 10，等待上限取$2^{10}-1$ 
---
##### *8、TCP和UDP异同点*
TCP：
1. 首部更长
2. 带有拥塞控制
3. 保证数据可靠传输
4. 需要建立连接
5. 面向字节流

UDP：
1. 首部携带信息更少
2. 没有拥塞控制
3. 不保证数据成功交付
4. 不需要提前建立连接
5. 面向报文

---
##### *9、GBN和SR工作过程和发送窗口尺寸（异同点）*
GBN：
1. GBN 维护一个窗口，使得最多有 N 个包已经发送但仍未确认
2. GBN 在数据报头部加上序列号
3. GBN 接收方采用累积确认
4. GBN 发送方为每个已发送但未收到确认的包，创建一个计时器，如果检测到超时，就重传从该包开始的 N 个包
5. GBN 接收方会丢弃所有失序包  

SR：
1. SR 接收方维护一个缓存，缓存所有失序到达的包，对每个分组都进行确认
2. SR 发送方和接收方都维护各自的窗口，采用累积确认来保证窗口滑动
---
##### 10、*描述DOS环境下DNS手动查询获取网站IP过程。DNS各层次间的关系*

1. 查询根服务器的ip：
	`nslookup .`
2. 查询顶级域名服务器的 ip：
	`nslookup -qt=ns .com A`
3. 查询权威域名服务器的 ip：
	`nslookup -qt=ns google.com B`
4. 查询访问域名的 ip：
	`nslookup  -qt=a www.google.com C`

---
##### *11、TCP发送方接收方特点，接收方收到错误或乱序的数据包如何处理*

发送方：
1. 维护一个窗口，类似于GBN，但检测到超时时只会重传一个包
2. 采用累积确认，收到确认应答才移动窗口
3. 如果收到三个冗余 ACK 则快速重传，不需要等到超时
4. 通过增加超时间隔，提供流量控制

接收方：
1. 维护一个缓存，缓存那些失序到达的包，等待累积确认成功后一并交付给上层
2. 维护一个流量控制窗口，用于抑制发送方的传输

错误包：发出一个最近确认的包的冗余 ACK
失序包：如果在窗口范围内，缓存到本地，等到前面的包都到达后，再一并交付给上层

---
##### *12、描述TCP连接创建和断开过程*

创建：
1. 客户端发送一个 SYN 报文，设置好 TCP 选项，TCP初始序列号和目标端口
2. 服务端接收到 SYN 报文，回复一个 SYN ACK 报文，序列号为初始序列号加一
3. 客户端收到 SYN ACK 报文，回复 一个 ACK 报文，该报文可以携带正常传输的数据，完成三次握手

断开：
1. 客户端发送一个 FIN 报文
2. 服务端收到后，回复一个 ACK 报文，收到断开请求
3. 等到服务端准备好断开连接后，服务端会向客户端发送一个 FIN 报文
4. 此时如果客户端收到 FIN 报文，就回复一个 ACK 报文
5. 若服务端迟迟不收到 ACK，认为 FIN 报文丢失，重传 FIN 报文，直到收到客户端发回的  ACK
6. 服务端收到 ACK 报文后，就释放资源
7. 客户端会等待一段时间，如果没有收到重传的 FIN 报文，就认为 服务端已经收到 ACK 报文，此时客户端释放资源，至此双方断开连接

---
##### 13、*数据报网络和虚电路网络的异同点*

数据报网络：
1. 传输路径不固定
2. 连接不是必须的
3. 分组可能乱序到达
4. 采用 目的 IP 地址 指示目的地
5. 分组可能会丢失，可靠性由传输协议保证

虚电路网络：
1. 传输路径固定，必须沿着分配的路径传输
2. 必须先建立确定的连接再传输
3. 分组是有序到达的
4. 采用 虚电路标识号 指示路径
5. 传输可靠性由网络保证

---
##### 14、*为什么要包含层次选路AS的划分和各自的协议特点*

原因：
1.  IP 地址的数量过于庞大，必须分层次进行管理和路由
2. 不同的机构希望能自治管理自己范围内的路由器，以满足现实需求

划分：每个AS 通常由一组处在统一控制管理下的路由器集合组成

协议：
1. AS 内部：
	- RIP：采用距离向量算法（DV），该算法是异步的，需要不断地迭代至稳定状态，健壮性差
	- OSPF：采用洪泛链路状态和 Dijkstra 算法，该算法是一个全局状态算法
2. AS 间：
	- BGP：处理路由器到各个子网的可达性与路由表，并通过广播宣告本地子网的存在，实现因特网内 AS 间的互知性

---
##### *15、怎样保证路由表准确无误？*

1. 维护 TTL 存活时间，防止出现环路
2. 毒性逆转、水平分割：避免向信息来源传递信息，传递不可达的假信息
3. 触发更新：每当路由更新就广播其状态

---
##### *16、HTTP报文简述*
---
##### *17、描述电子邮件传输协议*

1. 用户将邮件写好后，提供目的邮箱，由本机上的用户代理程序将其发送到邮件服务器 A 的报文队列中
2. 邮件服务器 A 发现该报文，与目的邮件服务器 B 建立 TCP 连接，开始传输报文
3. B 收到邮件后将其放入目的邮箱，接收方通过用户代理阅读邮件

---
##### *18、距离向量算法（DV）和链路状态算法（LS）的区别*

DV ：
1. 每个节点只保存自身与其直接邻居的状态，无法得知全局拓扑状态
2. 整个路由表需要较长时间后才能收敛到正确状态
3. 一旦某个节点出现异常，会将错误传递至整个网络，健壮性较差

LS ：
1. 采用洪泛链路状态，每个节点保存全局的节点状态与拓扑
2. 算法收敛速度较快
3. 该算法的传递报文，所包含的信息更长
4. 由于节点内部保存着全局拓扑，因此更容易检测出异常

---
##### *19、电路交换、分组交换、报文交换优缺点*

电路交换：
1. 基于连接传输，稳定，可靠，传输块
2. 纠错能力差，连接建立时间长，占用大量带宽

报文交换：
1. 不需要提前建立连接，采用路由转发，资源利用率高，灵活性好
2. 需要较大的路由器内部缓存，转发时延大，容易出现HOL阻塞

分组交换：
1. 传输灵活性好，采用路由转发，单个数据包的内容较少，利于缓存管理
2. 增加了首部信息，总传输量增大，分组交换不稳定，易出现丢包、乱序等问题，需要可靠数据传输协议


---
##### *20、Google（25分必考）*

首先用户将其设备在物理层面上接入以太网

传输报文时，会将报文向下逐层封装，收到时再提取，下面均省略该步骤
 
接着用户主机（称为 host）通过 DHCP 协议获取可用 IP
1. host 设置目的 MAC 为全 1， 发送广播 DHCP 发现报文，寻找可用的 DHCP 服务器
2. DHCP 服务器通过 DHCP 中继代理（或者直接地）收到 DHCP 发现报文后，分配一个 IP 地址，将服务器IP、网关 IP、DNS服务器IP、分配 IP、租用时长等信息封装到 DHCP 响应报文中，发送回 host
3. host 从至少一个 DHCP 服务器处收到 响应报文，从中选择一个进行请求，发送 DHCP 请求报文
4. DHCP 服务器收到 请求报文 后，回复一个 DHCP 确认报文，确定分配 IP 资源
5. host 收到 DHCP  确认报文后，开始使用分配 IP，DHCP 服务完成

要访问 DNS 服务，必须通过 ARP 协议获取 MAC 地址，以本地 DNS 服务器为例
1. 如果目标 IP 与 host 在同一子网，直接广播目标IP 的 ARP 请求即可，下面讨论二者不在同一子网的情况
2. host 先广播网关 IP 的 ARP 请求报文，通过网关回复的 ARP 应答报文，得到网关的 MAC 地址
3. 随后把目的 MAC 修改为 网关 MAC，目的 IP 不变，将 DNS 查询报文发送给网关路由器
4. 随后网关路由器通过路由表获取 下一跳 的 IP 地址，同样使用 ARP 协议获取 MAC 地址，如果有 NAT 功能，还会将 host 的 IP 分配一个外网 IP 和端口号映射
5. 这样，DNS 报文通过 AS 间（BGP）和 AS 内部（RIP、OSPF）协议在子网间不断进行转发，最后到达 DNS 服务器

下面叙述省略使用 ARP 协议的过程

接着 host 需要通过 DNS 服务得知 google.com 的 IP 地址
1. 每次查询 DNS 服务器时，都先查询 DNS 缓存中有没有目标域名，有的话直接回答结果，下面的叙述省略该过程
2. host 首先查找本地缓存，如果没有，则向本地 DNS 服务器发送 DNS 查询报文，发起递归查询
3. 本地 DNS 服务器依次向 根 DNS、顶级域 DNS、权威 DNS 服务器 进行层次查询，随后将得到的 IP 地址通过 DNS 回答报文 发送回 host

然后 host 需要与 google.com 的服务器建立 TCP 连接
1. host 发送 SYN 报文，设置 TCP 初始序列号
2. 服务器收到后，为该连接分配端口，回复 SYN ACK 报文
3. host 再回复 ACK 报文，该报文可以携带正常传输的信息，三次握手完成

最后 host 通过 HTTP 协议获取网页内容
1. host 发送 HTTP GET 报文
2. 服务器收到 GET 报文后，再回复 HTTP 响应报文，包含服务器上的 HTML 网页文件
3. host 收到 响应报文后，在浏览器上显示网页内容 