router

用作网络层节点

---
---
## [[路由器]]工作原理

四个组件：
1. 输入端口
2. 交换结构
3. 输出端口
4. 路由选择处理器

### 1. 输入端口处理和基于目的地转发

路由处理选择器计算路由表，将路由表复制到线路卡
每个输入端口，使用线路卡的影子副本，在本地做出转发决策，避免了集中式处理

转发表可对 目的地址 采用 *最长前缀匹配规则* 映射输出端口

该过程是一个“[[匹配加操作]]”抽象

### 2. 交换

处理过程：
1. 线路端接
2. 数据链路处理（协议，拆封）
3. 查找，转发，排队
4. 发往交换结构

三种交换技术：
1. 内存交换
	- 早期计算机实现
	- 受容量大小限制
2. 总线交换
	- 适用于小规模局域网
	- 同一时刻只能传输一个分组
3. 互联网络交换
	- 2N 纵横布线
	- 同一时刻最多 N 个并行交换
	- 非阻塞

### 3. 输出端口处理

过程：
1. 从交换结构接取
2. 排队（缓存管理）
3. 数据链路处理（协议、封装）
4. 线路端接

### 4. 何时出现排队

排队取决于：
1. 流量负载
2. 交换结构的相对速率
3. 线路速率

#### 输入排队

原因：传送时延固定存在

**队列首部阻塞**（[[HOL阻塞]]，Head-Of-the-Line）


#### 输出排队

原因：多个分组要求同一个输出端口，处理时延固定存在

缓存已满时：
1. 要么丢弃新分组
2. 要么丢弃正在排队的旧分组

为避免丢包，我们可以主动释放队列空间，为发送方提供一个拥塞信号，实现拥塞控制

这样的策略称为**主动队列管理**（AQM)，典型为**随机早期检测算法**(RED)

排队时，由输出端口的 **分组调度器** 来决定传输哪个分组

#### 多少缓存才“够用”？

经验公式:
$$
B = RTT \times C 
$$

其中 B 为缓存数量，[[RTT]] 为平均往返时延，C 为链路容量

存在 N 条并行 TCP 流时，经验公式为：
$$
 B = RTT \cdot C / \sqrt{N}
$$
缓存是一把双刃剑：
- 大缓存会增强吞吐能力，但也增加了潜在的排队时延

当发送方持续发送流量时，用户感受到的时延 受到 **最小时延** 限制，这种情况称为 **缓存膨胀**

---
### 分组调度

- 先进先出 FIFO

- 优先权排队

- 循环和加权公平排队



