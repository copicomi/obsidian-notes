*域名系统 DNS(Domain Name System)*

---
### DNS 提供的服务

提供主机名向 IP 地址转换的服务

DNS是：
1. 一个由分层的 DNS 服务器实现的 **分布式数据库**
2. 一个使得主机能够查询分布式数据库的 **应用层协议**

DNS服务器：BIND 软件的 UNIX 机器
DNS协议 ： UDP、Port53

当客户发出一个请求 URL 时，DNS 工作过程如下：
1. 前提：该主机上运行着 DNS 应用的客户端
2. 浏览器从 URL 中抽取出 hostname，传给 DNS 客户端
3. DNS 客户向 DNS 服务端 发出包含 hostname 的请求
4. DNS 服务端响应 hostname 对应的 IP 地址
5. 浏览器接收到 IP 地址，发起 TCP 连接

其他服务：
1. 解析主机别名
2. 解析邮件服务器别名
3. 负载分配
	- 有时一个 hostname 可能对应多台 服务器 IP 地址，DNS 在这些服务器间循环提供地址（而不是总是响应第一个服务器），在服务器间平衡了负载

---
### DNS 工作机理概述
 现代 DNS 服务采用分布式设计

 ##### 分布式、层次数据库
 分层设计：
 1. 根 DNS 服务器
 2. 顶级域（TLD）DNS 服务器
 3. 权威 DNS 服务器
 树型结构，树型查找
 另有**本地 DNS 服务器**，三层 DNS 服务器之间并不直接通信，而是由本地 DNS 服务器逐层询问，直至权威 DNS 服务器响应目标地址
 递归查询 与 迭代查询
 - 区别：查询信息是否直接返回原主机，查询层次是不是只有一层

---
### DNS 缓存
 在 DNS 服务器中 缓存 先前查询的记录结果，一定时间后丢弃缓存
 缓存的存在使得根服务器常常被绕过查询，减少了报文次数
 
---
### DNS 记录和报文
 资源记录（RR Resource Record）提供主机名到 IP 地址的映射，存储在 DNS 服务器上
 RR 是一个四元组 `(Name, Value, Type, TTL)`
 - `TTL` 记录在缓存中保存的时间，超时则删除
 - `Name` 和 `Value` 的语义取决于 `Type` 的值
	 - `Type` 的值域为 `{A, NS, CNAME, MX}`，决定映射类型
	 - 对应映射类型为 `{主机-IP, 域DNS-权威DNS, 别名-规范名, 邮件服务器别名-规范名}`
 
#### DNS 报文
 首部-问题-回答-权威-附加信息

#### 在 DNS 数据库中插入记录
 向[[注册登记机构]]申请注册域名，提供 权威 DNS 服务器名字 与 IP 地址，机构会将对应的 RR 插入 TLD DNS 服务器 的数据库

*DNS 攻击实例* ：
- DDoS 攻击：大量的无效请求攻击 TLD DNS
- 伪造：截取 DOS 服务器的回答，伪装成 DNS 服务器，响应错误的报文，这会将用户重定向至攻击者的网站

---
