*内容分发网*

---
### 内容分发网

实际产品：[[YouTube]]

最简单的服务提供方式：部署单一的巨大数据中心
缺点：时延、不稳定、反复传输

因此利用**内容分发网（[[CDN]]）** 
- CDN 服务器部署在多个地理位置
- 专用 CDN 和第三方 CDN 均可

CDN 的服务器安置原则
1. 深入
	- 在全球各处的接入 ISP 中部署 CDN 集群
	- 目的为靠近端用户，采用高度分布式设计
2. 邀请做客
	- 在少量关键位置建造大集群，邀请 ISP 做客
	- 通常放置在 IXP 处
	- 维护成本低，但用户体验不如深入部署

CDN 的传输策略类似于 Web 缓存，当用户请求时才将视频从远程拉入本地副本，一段时间后删除副本

#### CDN 操作
当用户发出视频请求时，CDN 截获报文，决定使用哪个 CDN 集群，并重定向至新的服务器

以使用 DNS 截取的 CDN 为例，工作过程如下：
1. 用户访问 Web 网页
2. 用户点击视频连接，发送 DNS 请求
3. 本地 DNS 服务器接收到请求，注意到这是一个视频相关，返回一个 CDN 域的主机名（而不是目标的 IP 地址），移交 DNS 请求
4. CDN 集群给出用户应该连接的服务器地址，返回给本地 DNS 服务器（LDNS）
5. [[LDNS]] 返回 CDN 给出的 IP 地址
6. 客户端与收到的 IP 建立 直接的 TCP 连接，开始视频服务

#### 集群选择策略
最简单的策略是：选择地理位置最近的集群，但**时延不一定最短**
部分 CDN 进行对集群的时延周期性测量，缺点是浪费一定 LDNS 资源

---
#### Netflix
两个部件：亚马逊云、专用 CDN 基础设施
- Web网站控制用户相关数据，运行在亚马逊云上
- 此外，亚马逊云处理以下功能
	- 内容摄取
	- 内容处理
	- 向 CDN 上载版本
- Netflix CDN 部署在 ISP 和 IXP 上，并专门用于 视频流 的播放，简化 CDN 设计
- 同时 CDN 采用推高速缓存，空闲时将内容推入下层服务器
Netflix Web 向用户提供视频 URL 的相关信息，然后客户端向 CDN 请求数据即可

#### YouTube
采用拉高速缓存和 DNS 重定向，以平衡集群负载
应用 HTTP 流，没有适应性流，要求用户人工选择版本
数据处理全部发生在谷歌数据中心