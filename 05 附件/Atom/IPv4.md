一个网络层 IP 协议

---
---

### [[IPv4]] 数据报格式
1. 版本号
2. 首部长度
3. 服务类型
4. 数据报总长度
5. 标识、标志、片偏移
6. 寿命 TTL
7. 协议
8. 首部检验和
9. 源和目的 IP 地址
10. 选项

---
### IPv4 编址

每个 IP 地址与一个[[接口]]相关联

前缀若干位表示子网掩码

子网中的 IP 地址，前缀都相同

因特网分配策略称为 *无类别域间路由选择（[[CIDR]]）*
CIDR 出现前，通常规定前缀只能是 8、16、24 位，分为 A、B、C 类网络，这种策略称为 *分类编址* 

路由器在寻路时，只需考虑对应的子网前缀

子网内部 也可根据 前缀 进行 再分块

而 IP 地址中 除 子网前缀 之外的 bit，由子网管理分配

下面描述，地址是如何被分配的

#### 获取子网地址

**子网**负责人 向其 **ISP** 管理员 联系，请求分配一块**连续的** IP 地址
而 ISP 占有的 IP 地址，由 *[[ICANN]]* 组织进行分配管理
#### 获取主机地址：*动态主机配置协议（[[DHCP]]）*

DHCP 允许主机从连接的子网中自动获取一个地址，**或临时或固定**，同时让主机得知必要的子网环境信息

这种自动化的方式，省去了手工配置的工作，更符合有大量主机频繁加入和退出的网络环境

每个子网都应具有一台 DHCP服务器，或 [[DHCP 中继代理]]

DHCP 采用 client-server 模型

DHCP 的工作过程：
1.  DHCP 服务器发现
	 - 起初，主机 C 并不知道自己所处的网络环境，必须通过广播手段，发送 *DHCP 发现报文（discover msg）*，使用 *广播目的地址 255.255.255.255，主机源地址 0.0.0.0 *
2.  DHCP 服务器提供
	 - 当 DHCP 服务器 S 收到 discover msg 时，同样开始广播 *DHCP 提供报文（offer msg）*
	 - offer msg 包含向 主机 C 提供的 地址、掩码、**IP地址租用期** 
3.  DHCP 请求
	 - 主机 C 可能收到多个 offer msg，此时择优发送 *DHCP 请求报文 （request msg）*
	 - request msg 包含回显参数
4.  DHCP ACK
	- 服务器 S 响应 ACK msg
	- 当 主机 C 收到 ACK msg，服务结束

---
